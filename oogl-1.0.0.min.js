/*! Object-Oriented Graphics Library - v1.0.0 - 2013-08-27
* Released under the MIT License
* http://oogljs.com/
* Copyright (c) 2013 Alberto La Rocca */
var OOGL=function(a){"function"==typeof a&&document.addEventListener("DOMContentLoaded",function(){a.call(OOGL,OOGL)},!1)};"undefined"==typeof $&&($=OOGL),OOGL.Timing={now:function(){return"performance"in window&&"now"in window.performance?window.performance.now.bind(window.performance):Date.now.bind(Date)}()},OOGL.Ajax=new function(){function a(a){var b="XMLHttpRequest"in window?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return b.onreadystatechange=a,b}function b(b,c){var d=c.callback,f="json"===c.type;f&&(c.type="");var g=new a(function(){4===g.readyState&&(200===g.status?d&&(f?d(JSON.parse(g.responseText)):d(g.response)):e())}),h=!0;if(c.hasOwnProperty("async")&&(h=c.async),c.hasOwnProperty("data")){var i=function(){var a={};return function b(c,d){if("object"!=typeof d)a[c]=""+d;else if(Array.isArray(d))if(d.length)for(var e in d)d.hasOwnProperty(e)&&b(c+"["+e+"]",d[e]);else a[c]="[]";else if(null!==d)if(Object.keys(d).length)for(var f in d)d.hasOwnProperty(f)&&(/^\w+$/.test(f)?b(c+"."+f,d[f]):b(c+'["'+f.replace('"','\\"')+'"]',d[f]));else a[c]="{}";else a[c]="null"}("",c.data),function(b){var c="";for(var d in a)a.hasOwnProperty(d)&&(b?b=!1:c+="&",c+=encodeURIComponent(d)+"="+encodeURIComponent(a[d]));return c}(!0)}();if(/^get$/i.test(b)){var j=c.url+"?"+i;c.hasOwnProperty("user")?c.hasOwnProperty("password")?g.open(b,j,h,c.user,c.password):g.open(b,j,h,c.user):g.open(b,j,h),c.hasOwnProperty("type")&&(g.responseType=c.type,"document"===c.type&&g.overrideMimeType&&g.overrideMimeType("text/xml")),g.send()}else c.hasOwnProperty("user")?c.hasOwnProperty("password")?g.open(b,c.url,h,c.user,c.password):g.open(b,c.url,h,c.user):g.open(b,c.url,h),c.hasOwnProperty("type")&&(g.responseType=c.type,"document"===c.type&&g.overrideMimeType&&g.overrideMimeType("text/xml")),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(i)}else c.hasOwnProperty("user")?c.hasOwnProperty("password")?g.open(b,c.url,h,c.user,c.password):g.open(b,c.url,h,c.user):g.open(b,c.url,h),c.hasOwnProperty("type")&&(g.responseType=c.type,"document"===c.type&&g.overrideMimeType&&g.overrideMimeType("text/xml")),g.send()}function c(a){function c(){throw"invalid arguments for "+a+" AJAX request"}return function(d,e,f,g){if("object"!=typeof d){var h={url:""+d};"object"!=typeof e?"function"!=typeof e?c():(h.callback=e,h.type=""+f,b(a,h)):(h.data=e,"function"!=typeof f?(h.type=""+f,b(a,h)):(h.callback=f,arguments.length>3&&(h.type=""+g),b(a,h)))}else b(a,d)}}function d(a){function c(){throw"invalid arguments for "+a+" AJAX request"}return function(d,e,f){var g={url:""+d,type:"json"};"object"!=typeof e?"function"!=typeof e?c():(g.callback=e,b(a,g)):(g.data=e,arguments.length>2&&(g.callback=f),b(a,g))}}var e=function(){};this.onError=function(a){e=a||function(){}},this.get=c("GET"),this.getJSON=d("GET"),this.post=c("POST"),this.postJSON=d("POST"),this.put=c("PUT"),this.putJSON=d("PUT"),this._delete=c("DELETE"),this.deleteJSON=d("DELETE")},OOGL.Async={async:function(a){return function(b,c){a(),b&&b.call(c)}},serial:function(){var a;return a=1===arguments.length&&"function"!=typeof arguments[0]?arguments[0]:arguments,function(b,c){a.length?function d(e){a[e](function(){e<a.length-1?d(e+1):b&&b.call(c)})}(0):b&&b.call(c)}},parallel:function(){var a;return a=1===arguments.length&&"function"!=typeof arguments[0]?arguments[0]:arguments,function(b,c){if(a.length)for(var d=a.length,e=0;e<a.length;e++)a[e](function(){--d||b&&b.call(c)});else b&&b.call(c)}}},OOGL.Vector2=function(a,b){this.x=a,this.y=b},OOGL.Vector2.prototype={clone:function(){return new OOGL.Vector2(this.x,this.y)},toArray:function(){return[this.x,this.y]},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);return this.x/=a,this.y/=a,this},getNormalized:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);return new OOGL.Vector2(this.x/a,this.y/a)},add:function(a){return this.x+=a.x,this.y+=a.y,this},plus:function(a){return new OOGL.Vector2(this.x+a.x,this.y+a.y)},subtract:function(a){return this.x-=a.x,this.y-=a.y,this},minus:function(a){return new OOGL.Vector2(this.x-a.x,this.y-a.y)},multiply:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return this.x/=a,this.y/=a,this},by:function(a){return new OOGL.Vector2(this.x*a,this.y*a)},dot:function(a){return this.x*a.x+this.y*a.y},reflect:function(a){var b=this.x*a.x+this.y*a.y;return this.x-=2*b*a.x,this.y-=2*b*a.y,this},getReflected:function(a){var b=this.x*a.x+this.y*a.y;return new OOGL.Vector2(this.x-2*b*a.x,this.y-2*b*a.y)},refract:function(a,b){var c=this.x*a.x+this.y*a.y,d=1-b*b*(1-c*c);return 0>d?(this.x=0,this.y=0):(this.x=b*this.x-(b*c+Math.sqrt(d))*a.x,this.y=b*this.y-(b*c+Math.sqrt(d))*a.y),this},getRefracted:function(a,b){var c=this.x*a.x+this.y*a.y,d=1-b*b*(1-c*c);return 0>d?OOGL.Vector2.NULL:new OOGL.Vector2(b*this.x-(b*c+Math.sqrt(d))*a.x,b*this.y-(b*c+Math.sqrt(d))*a.y)}},OOGL.Vector2.NULL=new OOGL.Vector2(0,0),OOGL.Vector2.I=new OOGL.Vector2(1,0),OOGL.Vector2.J=new OOGL.Vector2(0,1),OOGL.Vector3=function(a,b,c){this.x=a,this.y=b,this.z=c},OOGL.Vector3.prototype={clone:function(){return new OOGL.Vector3(this.x,this.y,this.z)},toArray:function(){return[this.x,this.y,this.z]},toHomogeneous:function(){return new OOGL.Vector4(this.x,this.y,this.z,1)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=a,this.y/=a,this.z/=a,this},getNormal:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return new OOGL.Vector3(this.x/a,this.y/a,this.z/a)},add:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},plus:function(a){return new OOGL.Vector3(this.x+a.x,this.y+a.y,this.z+a.z)},subtract:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},minus:function(a){return new OOGL.Vector3(this.x-a.x,this.y-a.y,this.z-a.z)},multiply:function(a){return this.x*=a,this.y*=a,this.z*=a,this},divide:function(a){return this.x/=a,this.y/=a,this.z/=a,this},by:function(a){return new OOGL.Vector3(this.x*a,this.y*a,this.z*a)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(a){var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z,d=this.x*a.y-this.y*a.x;return this.x=b,this.y=c,this.z=d,this},getCrossProduct:function(a){return new OOGL.Vector3(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},reflect:function(a){var b=this.x*a.x+this.y*a.y+this.z*a.z;return this.x-=2*b*a.x,this.y-=2*b*a.y,this.z-=2*b*a.z,this},getReflected:function(a){var b=this.x*a.x+this.y*a.y+this.z*a.z;return new OOGL.Vector3(this.x-2*b*a.x,this.y-2*b*a.y,this.z-2*b*a.z)},refract:function(a,b){var c=this.x*a.x+this.y*a.y+this.z*a.z,d=1-b*b*(1-c*c);return 0>d?(this.x=0,this.y=0,this.z=0):(this.x=b*this.x-(b*c+Math.sqrt(d))*a.x,this.y=b*this.y-(b*c+Math.sqrt(d))*a.y,this.z=b*this.z-(b*c+Math.sqrt(d))*a.z),this},getRefracted:function(a,b){var c=this.x*a.x+this.y*a.y+this.z*a.z,d=1-b*b*(1-c*c);return 0>d?OOGL.Vector3.NULL:new OOGL.Vector3(b*this.x-(b*c+Math.sqrt(d))*a.x,b*this.y-(b*c+Math.sqrt(d))*a.y,b*this.z-(b*c+Math.sqrt(d))*a.z)}},OOGL.Vector3.NULL=new OOGL.Vector3(0,0,0),OOGL.Vector3.I=new OOGL.Vector3(1,0,0),OOGL.Vector3.J=new OOGL.Vector3(0,1,0),OOGL.Vector3.K=new OOGL.Vector3(0,0,1),OOGL.Vector4=function(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d},OOGL.Vector4.prototype={clone:function(){return new OOGL.Vector4(this.x,this.y,this.z,this.w)},toArray:function(){return[this.x,this.y,this.z,this.w]},toStandard:function(){return new OOGL.Vector3(this.x/this.w,this.y/this.w,this.z/this.w)}},OOGL.Matrix2=function(a){if(4!=a.length)throw"A 2x2 matrix must have exactly 4 elements.";for(var b=0;4>b;b++)this[b]=a[b]},OOGL.Matrix2.prototype={clone:function(){return new OOGL.Matrix2([this[0],this[1],this[2],this[3]])},get:function(a,b){return this[2*b+a]},put:function(a,b,c){return this[2*b+a]=c,this},transpose:function(){for(var a=[this[0],this[2],this[1],this[3]],b=0;4>b;b++)this[b]=a[b];return this},getTransposed:function(){return new OOGL.Matrix2([this[0],this[2],this[1],this[3]])},add:function(a){for(var b=0;4>b;b++)this[b]+=a[b];return this},plus:function(a){for(var b=[],c=0;4>c;c++)b.push(this[c]+a[c]);return new OOGL.Matrix2(b)},subtract:function(a){for(var b=0;4>b;b++)this[b]-=a[b];return this},minus:function(a){for(var b=[],c=0;4>c;c++)b.push(this[c]-a[c]);return new OOGL.Matrix2(b)},multiply:function(a){for(var b=0;4>b;b++)this[b]*=a;return this},by:function(a){if(a instanceof OOGL.Vector2)return new OOGL.Vector2(this[0]*a.x+this[2]*a.y,this[1]*a.x+this[3]*a.y);if(a instanceof OOGL.Matrix2)return new OOGL.Matrix2([this[0]*a[0]+this[2]*a[1],this[1]*a[0]+this[3]*a[1],this[0]*a[2]+this[2]*a[3],this[1]*a[2]+this[3]*a[3]]);for(var b=[],c=0;4>c;c++)b.push(this[c]*a);return new OOGL.Matrix2(b)},determinant:function(){return this[0]*this[3]-this[1]*this[2]},invert:function(){for(var a=this[0]*this[3]-this[1]*this[2],b=[this[3]/a,this[2]/a,this[1]/a,this[0]/a],c=0;4>c;c++)this[c]=b[c];return this},getInverse:function(){var a=this[0]*this[3]-this[1]*this[2];return new OOGL.Matrix2([this[3]/a,this[2]/a,this[1]/a,this[0]/a])}},OOGL.Matrix2.NULL=new OOGL.Matrix2([0,0,0,0]),OOGL.Matrix2.IDENTITY=new OOGL.Matrix2([1,0,0,1]),OOGL.RotationMatrix2=function(a){var b=Math.sin(a),c=Math.cos(a);return new OOGL.Matrix2([c,b,-b,c])},OOGL.ScalingMatrix2=function(a,b){return new OOGL.Matrix2([a,0,0,b])},OOGL.Matrix3=function(a){if(9!=a.length)throw"A 3x3 matrix must have exactly 9 elements.";for(var b=0;9>b;b++)this[b]=a[b]},OOGL.Matrix3.prototype={clone:function(){return new OOGL.Matrix3([this[0],this[1],this[2],this[3],this[4],this[5],this[6],this[7],this[8]])},toHomogeneous:function(){return new OOGL.Matrix4([this[0],this[1],this[2],0,this[3],this[4],this[5],0,this[6],this[7],this[8],0,0,0,0,1])},get:function(a,b){return this[3*b+a]},put:function(a,b,c){return this[3*b+a]=c,this},transpose:function(){for(var a=[this[0],this[3],this[6],this[1],this[4],this[7],this[2],this[5],this[8]],b=0;9>b;b++)this[b]=a[b];return this},getTransposed:function(){return new OOGL.Matrix3([this[0],this[3],this[6],this[1],this[4],this[7],this[2],this[5],this[8]])},add:function(a){for(var b=0;9>b;b++)this[b]+=a[b];return this},plus:function(a){for(var b=[],c=0;9>c;c++)b.push(this[c]+a[c]);return new OOGL.Matrix3(b)},subtract:function(a){for(var b=0;9>b;b++)this[b]-=a[b];return this},minus:function(a){for(var b=[],c=0;9>c;c++)b.push(this[c]-a[c]);return new OOGL.Matrix3(b)},multiply:function(a){var b;if(a instanceof OOGL.Matrix3){var c=[this[0]*a[0]+this[3]*a[1]+this[6]*a[2],this[1]*a[0]+this[4]*a[1]+this[7]*a[2],this[2]*a[0]+this[5]*a[1]+this[8]*a[2],this[0]*a[3]+this[3]*a[4]+this[6]*a[5],this[1]*a[3]+this[4]*a[4]+this[7]*a[5],this[2]*a[3]+this[5]*a[4]+this[8]*a[5],this[0]*a[6]+this[3]*a[7]+this[6]*a[8],this[1]*a[6]+this[4]*a[7]+this[7]*a[8],this[2]*a[6]+this[5]*a[7]+this[8]*a[8]];for(b=0;9>b;b++)this[b]=c[b]}else for(b=0;9>b;b++)this[b]*=a;return this},by:function(a){if(a instanceof OOGL.Matrix3)return new OOGL.Matrix3([this[0]*a[0]+this[3]*a[1]+this[6]*a[2],this[1]*a[0]+this[4]*a[1]+this[7]*a[2],this[2]*a[0]+this[5]*a[1]+this[8]*a[2],this[0]*a[3]+this[3]*a[4]+this[6]*a[5],this[1]*a[3]+this[4]*a[4]+this[7]*a[5],this[2]*a[3]+this[5]*a[4]+this[8]*a[5],this[0]*a[6]+this[3]*a[7]+this[6]*a[8],this[1]*a[6]+this[4]*a[7]+this[7]*a[8],this[2]*a[6]+this[5]*a[7]+this[8]*a[8]]);if(a instanceof OOGL.Vector3)return new OOGL.Vector3(this[0]*a.x+this[3]*a.y+this[6]*a.z,this[1]*a.x+this[4]*a.y+this[7]*a.z,this[2]*a.x+this[5]*a.y+this[8]*a.z);for(var b=[],c=0;9>c;c++)b.push(this[c]*a);return new OOGL.Matrix3(b)},determinant:function(){return this[0]*(this[4]*this[8]-this[5]*this[7])-this[3]*(this[1]*this[8]-this[2]*this[7])+this[6]*(this[1]*this[5]-this[2]*this[4])},invert:function(){for(var a=this[0]*(this[4]*this[8]-this[5]*this[7])-this[3]*(this[1]*this[8]-this[2]*this[7])+this[6]*(this[1]*this[5]-this[2]*this[4]),b=[(this[4]*this[8]-this[5]*this[7])/a,(this[2]*this[7]-this[1]*this[8])/a,(this[1]*this[5]-this[2]*this[4])/a,(this[5]*this[6]-this[3]*this[8])/a,(this[0]*this[8]-this[2]*this[6])/a,(this[2]*this[3]-this[0]*this[5])/a,(this[3]*this[7]-this[4]*this[6])/a,(this[1]*this[6]-this[0]*this[7])/a,(this[0]*this[4]-this[1]*this[3])/a],c=0;9>c;c++)this[c]=b[c];return this},getInverse:function(){var a=this[0]*(this[4]*this[8]-this[5]*this[7])-this[3]*(this[1]*this[8]-this[2]*this[7])+this[6]*(this[1]*this[5]-this[2]*this[4]);return new OOGL.Matrix3([(this[4]*this[8]-this[5]*this[7])/a,(this[2]*this[7]-this[1]*this[8])/a,(this[1]*this[5]-this[2]*this[4])/a,(this[5]*this[6]-this[3]*this[8])/a,(this[0]*this[8]-this[2]*this[6])/a,(this[2]*this[3]-this[0]*this[5])/a,(this[3]*this[7]-this[4]*this[6])/a,(this[1]*this[6]-this[0]*this[7])/a,(this[0]*this[4]-this[1]*this[3])/a])}},OOGL.Matrix3.NULL=new OOGL.Matrix3([0,0,0,0,0,0,0,0,0]),OOGL.Matrix3.IDENTITY=new OOGL.Matrix3([1,0,0,0,1,0,0,0,1]),OOGL.RotationMatrix3=function(a,b,c,d){var e=Math.sin(d),f=Math.cos(d);return new OOGL.Matrix3([a*a*(1-f)+f,a*b*(1-f)+c*e,a*c*(1-f)-b*e,b*a*(1-f)-c*e,b*b*(1-f)+f,b*c*(1-f)+a*e,c*a*(1-f)+b*e,c*b*(1-f)-a*e,c*c*(1-f)+f])},OOGL.XRotationMatrix3=function(a){var b=Math.sin(a),c=Math.cos(a);return new OOGL.Matrix3([1,0,0,0,c,b,0,-b,c])},OOGL.YRotationMatrix3=function(a){var b=Math.sin(a),c=Math.cos(a);return new OOGL.Matrix3([c,0,-b,0,1,0,b,0,c])},OOGL.ZRotationMatrix3=function(a){var b=Math.sin(a),c=Math.cos(a);return new OOGL.Matrix3([c,b,0,-b,c,0,0,0,1])},OOGL.ScalingMatrix3=function(a,b,c){return new OOGL.Matrix3([a,0,0,0,b,0,0,0,c])},OOGL.Matrix4=function(a){if(16!=a.length)throw"A 4x4 matrix must have exactly 16 elements.";for(var b=0;16>b;b++)this[b]=a[b]},OOGL.Matrix4.prototype={clone:function(){return new OOGL.Matrix4([this[0],this[1],this[2],this[3],this[4],this[5],this[6],this[7],this[8],this[9],this[10],this[11],this[12],this[13],this[14],this[15]])},get:function(a,b){return this[4*b+a]},put:function(a,b,c){return this[4*b+a]=c,this},transpose:function(){for(var a=[this[0],this[4],this[8],this[12],this[1],this[5],this[9],this[13],this[2],this[6],this[10],this[14],this[3],this[7],this[11],this[15]],b=0;16>b;b++)this[b]=a[b];return this},getTransposed:function(){return new OOGL.Matrix4([this[0],this[4],this[8],this[12],this[1],this[5],this[9],this[13],this[2],this[6],this[10],this[14],this[3],this[7],this[11],this[15]])},add:function(a){for(var b=0;16>b;b++)this[b]+=a[b];return this},plus:function(a){for(var b=[],c=0;16>c;c++)b.push(this[c]+a[c]);return new OOGL.Matrix4(b)},subtract:function(a){for(var b=0;16>b;b++)this[b]-=a[b];return this},minus:function(a){for(var b=[],c=0;16>c;c++)b.push(this[c]-a[c]);return new OOGL.Matrix4(b)},multiply:function(a){var b;if(a instanceof OOGL.Matrix4){var c=[this[0]*a[0]+this[4]*a[1]+this[8]*a[2]+this[12]*a[3],this[1]*a[0]+this[5]*a[1]+this[9]*a[2]+this[13]*a[3],this[2]*a[0]+this[6]*a[1]+this[10]*a[2]+this[14]*a[3],this[3]*a[0]+this[7]*a[1]+this[11]*a[2]+this[15]*a[3],this[0]*a[4]+this[4]*a[5]+this[8]*a[6]+this[12]*a[7],this[1]*a[4]+this[5]*a[5]+this[9]*a[6]+this[13]*a[7],this[2]*a[4]+this[6]*a[5]+this[10]*a[6]+this[14]*a[7],this[3]*a[4]+this[7]*a[5]+this[11]*a[6]+this[15]*a[7],this[0]*a[8]+this[4]*a[9]+this[8]*a[10]+this[12]*a[11],this[1]*a[8]+this[5]*a[9]+this[9]*a[10]+this[13]*a[11],this[2]*a[8]+this[6]*a[9]+this[10]*a[10]+this[14]*a[11],this[3]*a[8]+this[7]*a[9]+this[11]*a[10]+this[15]*a[11],this[0]*a[12]+this[4]*a[13]+this[8]*a[14]+this[12]*a[15],this[1]*a[12]+this[5]*a[13]+this[9]*a[14]+this[13]*a[15],this[2]*a[12]+this[6]*a[13]+this[10]*a[14]+this[14]*a[15],this[3]*a[12]+this[7]*a[13]+this[11]*a[14]+this[15]*a[15]];for(b=0;16>b;b++)this[b]=c[b]}else for(b=0;16>b;b++)this[b]*=a;return this},by:function(a){if(a instanceof OOGL.Matrix4)return new OOGL.Matrix4([this[0]*a[0]+this[4]*a[1]+this[8]*a[2]+this[12]*a[3],this[1]*a[0]+this[5]*a[1]+this[9]*a[2]+this[13]*a[3],this[2]*a[0]+this[6]*a[1]+this[10]*a[2]+this[14]*a[3],this[3]*a[0]+this[7]*a[1]+this[11]*a[2]+this[15]*a[3],this[0]*a[4]+this[4]*a[5]+this[8]*a[6]+this[12]*a[7],this[1]*a[4]+this[5]*a[5]+this[9]*a[6]+this[13]*a[7],this[2]*a[4]+this[6]*a[5]+this[10]*a[6]+this[14]*a[7],this[3]*a[4]+this[7]*a[5]+this[11]*a[6]+this[15]*a[7],this[0]*a[8]+this[4]*a[9]+this[8]*a[10]+this[12]*a[11],this[1]*a[8]+this[5]*a[9]+this[9]*a[10]+this[13]*a[11],this[2]*a[8]+this[6]*a[9]+this[10]*a[10]+this[14]*a[11],this[3]*a[8]+this[7]*a[9]+this[11]*a[10]+this[15]*a[11],this[0]*a[12]+this[4]*a[13]+this[8]*a[14]+this[12]*a[15],this[1]*a[12]+this[5]*a[13]+this[9]*a[14]+this[13]*a[15],this[2]*a[12]+this[6]*a[13]+this[10]*a[14]+this[14]*a[15],this[3]*a[12]+this[7]*a[13]+this[11]*a[14]+this[15]*a[15]]);if(a instanceof OOGL.Vector4)return new OOGL.Vector4(this[0]*a.x+this[4]*a.y+this[8]*a.z+this[12]*a.w,this[1]*a.x+this[5]*a.y+this[9]*a.z+this[13]*a.w,this[2]*a.x+this[6]*a.y+this[10]*a.z+this[14]*a.w,this[3]*a.x+this[7]*a.y+this[11]*a.z+this[15]*a.w);for(var b=[],c=0;16>c;c++)b.push(this[c]*a);return new OOGL.Matrix4(b)}},OOGL.Matrix4.NULL=new OOGL.Matrix4([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),OOGL.Matrix4.IDENTITY=new OOGL.Matrix4([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),OOGL.TranslationMatrix4=function(a,b,c){return new OOGL.Matrix4([1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1])},OOGL.RotationMatrix4=function(a,b,c,d){var e=Math.sin(d),f=Math.cos(d);return new OOGL.Matrix4([a*a*(1-f)+f,a*b*(1-f)+c*e,a*c*(1-f)-b*e,0,b*a*(1-f)-c*e,b*b*(1-f)+f,b*c*(1-f)+a*e,0,c*a*(1-f)+b*e,c*b*(1-f)-a*e,c*c*(1-f)+f,0,0,0,0,1])},OOGL.XRotationMatrix4=function(a){var b=Math.sin(a),c=Math.cos(a);return new OOGL.Matrix4([1,0,0,0,0,c,b,0,0,-b,c,0,0,0,0,1])},OOGL.YRotationMatrix4=function(a){var b=Math.sin(a),c=Math.cos(a);return new OOGL.Matrix4([c,0,-b,0,0,1,0,0,b,0,c,0,0,0,0,1])},OOGL.ZRotationMatrix4=function(a){var b=Math.sin(a),c=Math.cos(a);return new OOGL.Matrix4([c,b,0,0,-b,c,0,0,0,0,1,0,0,0,0,1])},OOGL.ScalingMatrix4=function(a,b,c){return new OOGL.Matrix4([a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1])},OOGL.OrthogonalProjection=function(a){return arguments.length<1&&(a=1),new OOGL.Matrix4([1,0,0,0,0,a,0,0,0,0,1,0,0,0,0,1])},OOGL.IsometricProjection=function(){},OOGL.PerspectiveProjection=function(a,b){arguments.length<2&&(b=Math.PI/2,arguments.length<1&&(a=1));var c=Math.cos(b/2);return new OOGL.Matrix4([c,0,0,0,0,c*a,0,0,0,0,0,1,0,0,1,c])},OOGL.Context=function(a,b){var c;c="string"!=typeof a?a:document.getElementById(a);var d=c.getContext("webgl",b);if(d||(d=c.getContext("experimental-webgl",b)),!d)throw"WebGL not supported.";return d.Buffer=function(){var a={"byte":{constructor:Int8Array,size:1},ubyte:{constructor:Uint8Array,size:1},"short":{constructor:Int16Array,size:2},ushort:{constructor:Uint16Array,size:2},"float":{constructor:Float32Array,size:4}};return function(b,c,e){var f;if(!a.hasOwnProperty(c))throw'Invalid buffer type, must be one of "byte", "ubyte", "short", "ushort" and "float".';f=a[c].constructor;var g=d.createBuffer();return g.is=function(){return d.isBuffer(g)},g.getParameter=function(a){return d.getBufferParameter(b,a)},g.getSize=function(){return d.getBufferParameter(b,d.BUFFER_SIZE)},g.getUsage=function(){return d.getBufferParameter(b,d.BUFFER_USAGE)},g.bind=function(){d.bindBuffer(b,g)},g.data=function(f){"number"!=typeof f&&(f=new a[c].constructor(f)),d.bufferData(b,f,e)},g.bindAndData=function(f){d.bindBuffer(b,g),"number"!=typeof f&&(f=new a[c].constructor(f)),d.bufferData(b,f,e)},g.subData=function(e,f){d.bufferSubData(b,e*a[c].size,new a[c].constructor(f))},g._delete=function(){d.deleteBuffer(g)},g}}(),d.StaticBuffer=function(a,b){return new d.Buffer(a,b,d.STATIC_DRAW)},d.StreamBuffer=function(a,b){return new d.Buffer(a,b,d.STREAM_DRAW)},d.DynamicBuffer=function(a,b){return new d.Buffer(a,b,d.DYNAMIC_DRAW)},d.ArrayBuffer=function(a,b){return new d.Buffer(d.ARRAY_BUFFER,a,b)},d.ElementArrayBuffer=function(a,b){return new d.Buffer(d.ELEMENT_ARRAY_BUFFER,a,b)},d.StaticArrayBuffer=function(a){return new d.StaticBuffer(d.ARRAY_BUFFER,a)},d.StaticElementArrayBuffer=function(a){return new d.StaticBuffer(d.ELEMENT_ARRAY_BUFFER,a)},d.StreamArrayBuffer=function(a){return new d.StreamBuffer(d.ARRAY_BUFFER,a)},d.StreamElementArrayBuffer=function(a){return new d.StreamBuffer(d.ELEMENT_ARRAY_BUFFER,a)},d.DynamicArrayBuffer=function(a){return new d.DynamicBuffer(d.ARRAY_BUFFER,a)},d.DynamicElementArrayBuffer=function(a){return new d.DynamicBuffer(d.ELEMENT_ARRAY_BUFFER,a)},d.AttributeArray1=function(a,b,c,e){var f={"byte":{glType:d.BYTE,size:1},ubyte:{glType:d.UNSIGNED_BYTE,size:1},"short":{glType:d.SHORT,size:2},ushort:{glType:d.UNSIGNED_SHORT,size:2},"float":{glType:d.FLOAT,size:4}};if(!f.hasOwnProperty(b))throw'Invalid attribute type, must be one of "byte", "ubyte", "short", "ushort" and "float".';var g=new d.StaticArrayBuffer(b);return g.bindAndData(c),g.enable=function(){d.enableVertexAttribArray(a)},g.disable=function(){d.disableVertexAttribArray(a)},g.pointer=function(c,g){d.vertexAttribPointer(a,1,f[b].glType,!!e,(c||0)*f[b].size,(g||0)*f[b].size)},g.bindAndPointer=function(c,h){d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,1,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g.enableBindAndPointer=function(c,h){d.enableVertexAttribArray(a),d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,1,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g},d.AttributeArray2=function(a,b,c,e){var f={"byte":{glType:d.BYTE,size:1},ubyte:{glType:d.UNSIGNED_BYTE,size:1},"short":{glType:d.SHORT,size:2},ushort:{glType:d.UNSIGNED_SHORT,size:2},"float":{glType:d.FLOAT,size:4}};if(!f.hasOwnProperty(b))throw'Invalid attribute type, must be one of "byte", "ubyte", "short", "ushort" and "float".';var g=new d.StaticArrayBuffer(b);return g.bindAndData(c),g.enable=function(){d.enableVertexAttribArray(a)},g.disable=function(){d.disableVertexAttribArray(a)},g.pointer=function(c,g){d.vertexAttribPointer(a,2,f[b].glType,!!e,(c||0)*f[b].size,(g||0)*f[b].size)},g.bindAndPointer=function(c,h){d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,2,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g.enableBindAndPointer=function(c,h){d.enableVertexAttribArray(a),d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,2,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g},d.AttributeArray3=function(a,b,c,e){var f={"byte":{glType:d.BYTE,size:1},ubyte:{glType:d.UNSIGNED_BYTE,size:1},"short":{glType:d.SHORT,size:2},ushort:{glType:d.UNSIGNED_SHORT,size:2},"float":{glType:d.FLOAT,size:4}};if(!f.hasOwnProperty(b))throw'Invalid attribute type, must be one of "byte", "ubyte", "short", "ushort" and "float".';var g=new d.StaticArrayBuffer(b);return g.bindAndData(c),g.enable=function(){d.enableVertexAttribArray(a)},g.disable=function(){d.disableVertexAttribArray(a)},g.pointer=function(c,g){d.vertexAttribPointer(a,3,f[b].glType,!!e,(c||0)*f[b].size,(g||0)*f[b].size)},g.bindAndPointer=function(c,h){d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,3,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g.enableBindAndPointer=function(c,h){d.enableVertexAttribArray(a),d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,3,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g},d.AttributeArray4=function(a,b,c,e){var f={"byte":{glType:d.BYTE,size:1},ubyte:{glType:d.UNSIGNED_BYTE,size:1},"short":{glType:d.SHORT,size:2},ushort:{glType:d.UNSIGNED_SHORT,size:2},"float":{glType:d.FLOAT,size:4}};if(!f.hasOwnProperty(b))throw'Invalid attribute type, must be one of "byte", "ubyte", "short", "ushort" and "float".';var g=new d.StaticArrayBuffer(b);return g.bindAndData(c),g.enable=function(){d.enableVertexAttribArray(a)},g.disable=function(){d.disableVertexAttribArray(a)},g.pointer=function(c,g){d.vertexAttribPointer(a,4,f[b].glType,!!e,(c||0)*f[b].size,(g||0)*f[b].size)},g.bindAndPointer=function(c,h){d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,4,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g.enableBindAndPointer=function(c,h){d.enableVertexAttribArray(a),d.bindBuffer(d.ARRAY_BUFFER,g),d.vertexAttribPointer(a,4,f[b].glType,!!e,(c||0)*f[b].size,(h||0)*f[b].size)},g},d.AttributeArrays=function(a){var b=[];return{add1:function(a,c,e){b.push(new d.AttributeArray1(b.length,a,c,e))},add1b:function(a,c){b.push(new d.AttributeArray1(b.length,"byte",a,c))},add1ub:function(a,c){b.push(new d.AttributeArray1(b.length,"ubyte",a,c))},add1s:function(a,c){b.push(new d.AttributeArray1(b.length,"short",a,c))},add1us:function(a,c){b.push(new d.AttributeArray1(b.length,"ushort",a,c))},add1f:function(a,c){b.push(new d.AttributeArray1(b.length,"float",a,c))},add2:function(a,c,e){b.push(new d.AttributeArray2(b.length,a,c,e))},add2b:function(a,c){b.push(new d.AttributeArray2(b.length,"byte",a,c))},add2ub:function(a,c){b.push(new d.AttributeArray2(b.length,"ubyte",a,c))},add2s:function(a,c){b.push(new d.AttributeArray2(b.length,"short",a,c))},add2us:function(a,c){b.push(new d.AttributeArray2(b.length,"ushort",a,c))},add2f:function(a,c){b.push(new d.AttributeArray2(b.length,"float",a,c))},add3:function(a,c,e){b.push(new d.AttributeArray3(b.length,a,c,e))},add3b:function(a,c){b.push(new d.AttributeArray3(b.length,"byte",a,c))},add3ub:function(a,c){b.push(new d.AttributeArray3(b.length,"ubyte",a,c))},add3s:function(a,c){b.push(new d.AttributeArray3(b.length,"short",a,c))},add3us:function(a,c){b.push(new d.AttributeArray3(b.length,"ushort",a,c))},add3f:function(a,c){b.push(new d.AttributeArray3(b.length,"float",a,c))},add4:function(a,c,e){b.push(new d.AttributeArray4(b.length,a,c,e))},add4b:function(a,c){b.push(new d.AttributeArray4(b.length,"byte",a,c))},add4ub:function(a,c){b.push(new d.AttributeArray4(b.length,"ubyte",a,c))},add4s:function(a,c){b.push(new d.AttributeArray4(b.length,"short",a,c))},add4us:function(a,c){b.push(new d.AttributeArray4(b.length,"ushort",a,c))},add4f:function(a,c){b.push(new d.AttributeArray4(b.length,"float",a,c))},enable:function(){for(var a=0;a<b.length;a++)d.enableVertexAttribArray(a)},disable:function(){for(var a=0;a<b.length;a++)d.disableVertexAttribArray(a)},bindAndPointer:function(a,c){for(var d in b)b.hasOwnProperty(d)&&b[d].bindAndPointer(a,c)},enableBindAndPointer:function(a,c){for(var e=0;e<b.length;e++)d.enableVertexAttribArray(e),b[e].bindAndPointer(a,c)},drawTriangles:function(a){return function(b,c){arguments.length<2&&(c=a,arguments.length<1&&(b=0)),d.drawArrays(d.TRIANGLES,b,c)}}(a),drawTriangleFan:function(a){return function(b,c){arguments.length<2&&(c=a,arguments.length<1&&(b=0)),d.drawArrays(d.TRIANGLE_FAN,b,c)}}(a),drawTriangleStrip:function(a){return function(b,c){arguments.length<2&&(c=a,arguments.length<1&&(b=0)),d.drawArrays(d.TRIANGLE_STRIP,b,c)}}(a),_delete:function(){for(var a in b)b.hasOwnProperty(a)&&b[a]._delete()}}},d.ElementArray=function(a,b){b||(b="ushort");var c=a.length,e={ubyte:d.UNSIGNED_BYTE,ushort:d.UNSIGNED_SHORT};if(!e.hasOwnProperty(b))throw'Invalid element type, must be either "ubyte" or "ushort".';var f=new d.StaticElementArrayBuffer(b);return f.bindAndData(a),f.drawTriangles=function(a){return function(c,f){arguments.length<2&&(f=a,arguments.length<1&&(c=0)),d.drawElements(d.TRIANGLES,f,e[b],c)}}(c),f.drawTriangleFan=function(a){return function(c,f){arguments.length<2&&(f=a,arguments.length<1&&(c=0)),d.drawElements(d.TRIANGLE_FAN,f,e[b],c)}}(c),f.drawTriangleStrip=function(a){return function(c,f){arguments.length<2&&(f=a,arguments.length<1&&(c=0)),d.drawElements(d.TRIANGLE_STRIP,f,e[b],c)}}(c),f},d.Texture=function(a){var b=d.createTexture();return b.is=function(){return d.isTexture(b)},b.bind=function(){d.bindTexture(a,b)},b.getParameter=function(b){return d.getTexParameter(a,b)},b.getMinFilter=function(){return d.getTexParameter(a,d.TEXTURE_MIN_FILTER)},b.getMagFilter=function(){return d.getTexParameter(a,d.TEXTURE_MAG_FILTER)},b.getWrapS=function(){return d.getTexParameter(a,d.TEXTURE_WRAP_S)},b.getWrapT=function(){return d.getTexParameter(a,d.TEXTURE_WRAP_T)},b.parameterf=function(b,c){d.texParameterf(a,b,c)},b.parameteri=function(b,c){d.texParameteri(a,b,c)},b.setMinFilter=function(b){d.texParameteri(a,d.TEXTURE_MIN_FILTER,b)},b.setMagFilter=function(b){d.texParameteri(a,d.TEXTURE_MAG_FILTER,b)},b.setWrapS=function(b){d.texParameteri(a,d.TEXTURE_WRAP_S,b)},b.setWrapT=function(b){d.texParameteri(a,d.TEXTURE_WRAP_T,b)},b.generateMipmap=function(){d.generateMipmap(a)},b.image2D=function(b,c,e,f){d.texImage2D(a,b,c,c,e,f)},b.subImage2D=function(b,c,e,f,g,h,i,j){d.texSubImage2D(a,b,c,e,f,g,h,i,j)},b.copyImage2D=function(b,c,e,f,g,h){d.copyTexImage2D(a,b,c,e,f,g,h,0)},b.copySubImage2D=function(b,c,e,f,g,h,i){d.copyTexSubImage2D(a,b,c,e,f,g,h,i)},b._delete=function(){d.deleteTexture(b)},b},d.Texture2D=function(){return new d.Texture(d.TEXTURE_2D)},d.AutoTexture=function(a,b,c){var e=new d.Texture2D;return e.bind(),arguments.length>1?(e.setMagFilter(b),arguments.length>2?e.setMinFilter(c):e.setMinFilter(d.LINEAR)):(e.setMagFilter(d.LINEAR),e.setMinFilter(d.LINEAR)),e.image2D(0,d.RGBA,d.UNSIGNED_BYTE,a),e},d.AsyncTexture=function(a,b,c,e){var f=new d.Texture2D;return f.bind(),arguments.length>2?(f.setMagFilter(c),arguments.length>3?f.setMinFilter(e):f.setMinFilter(d.LINEAR)):(f.setMagFilter(d.LINEAR),f.setMinFilter(d.LINEAR)),f.image=new Image,f.image.addEventListener("load",function(){f.bind(),f.image2D(0,d.RGBA,d.UNSIGNED_BYTE,f.image),b&&b.call(f)},!1),f.image.src=a,f},d.CubeMap=function(){return new d.Texture(d.TEXTURE_CUBE_MAP)},d.AsyncCubeMap=function(a,b,c,e){function f(b,c){return function(e){var f=new Image;f.addEventListener("load",function(){d.texImage2D(c,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,f),e()},!1),f.src=a.replace("%1",b)}}var g=new d.CubeMap;return g.bind(),arguments.length>2?(g.setMagFilter(c),arguments.length>3?g.setMinFilter(e):g.setMinFilter(d.LINEAR)):(g.setMagFilter(d.LINEAR),g.setMinFilter(d.LINEAR)),OOGL.Async.parallel(f("+X",d.TEXTURE_CUBE_MAP_POSITIVE_X),f("+Y",d.TEXTURE_CUBE_MAP_POSITIVE_Y),f("+Z",d.TEXTURE_CUBE_MAP_POSITIVE_Z),f("-X",d.TEXTURE_CUBE_MAP_NEGATIVE_X),f("-Y",d.TEXTURE_CUBE_MAP_NEGATIVE_Y),f("-Z",d.TEXTURE_CUBE_MAP_NEGATIVE_Z))(b),g},d.Textures=function(a){var b={},c=[];for(var e in a)a.hasOwnProperty(e)&&(b[e]=!0,c.push({name:e,texture:a[e]}));return{add:function(a,d){if(b.hasOwnProperty(a)){for(var e in c)if(c.hasOwnProperty(e)&&c[e].name==a)return c[e].texture=d,void 0}else b[a]=!0,c.push({name:a,texture:d})},bind:function(){for(var a=0;a<c.length;a++)d.activeTexture(d.TEXTURE0+a),c[a].texture.bind()},uniform:function(a){for(var b=0;b<c.length;b++)a.uniform1i(c[b].name,b)},bindAndUniform:function(a){for(var b=0;b<c.length;b++)d.activeTexture(d.TEXTURE0+b),c[b].texture.bind(),a.uniform1i(c[b].name,b)},_delete:function(){for(var a in c)c.hasOwnProperty(a)&&c[a].texture._delete();b={},c=[]}}},d.Shader=function(a){var b=d.createShader(a);return b.getParameter=function(a){return d.getShaderParameter(b,a)},b.getType=function(){return d.getShaderParameter(b,d.SHADER_TYPE)},b.source=function(a){d.shaderSource(b,a)},b.getSource=function(){return d.getShaderParameter(b,d.SHADER_SOURCE)},b.compile=function(){d.compileShader(b)},b.getCompileStatus=function(){return d.getShaderParameter(b,d.COMPILE_STATUS)},b.getInfoLog=function(){return d.getShaderInfoLog(b)},b.compileOrThrow=function(){if(d.compileShader(b),!d.getShaderParameter(b,d.COMPILE_STATUS))throw d.getShaderInfoLog(b)},b._delete=function(){d.deleteShader(b)},b.getDeleteStatus=function(){return d.getShaderParameter(b,d.DELETE_STATUS)},b},d.VertexShader=function(a){var b=new d.Shader(d.VERTEX_SHADER);return a&&(b.source(a),b.compileOrThrow()),b},d.FragmentShader=function(a){var b=new d.Shader(d.FRAGMENT_SHADER);return a&&(b.source(a),b.compileOrThrow()),b},d.AjaxVertexShader=function(a,b){var c=new d.Shader(d.VERTEX_SHADER);return OOGL.Ajax.get(a,function(e){if(c.source(e),c.compile(),!d.getShaderParameter(c,d.COMPILE_STATUS))throw"Failed to compile <"+a+">, info log follows.\n"+d.getShaderInfoLog(c);b&&b.call(c)}),c},d.AjaxFragmentShader=function(a,b){var c=new d.Shader(d.FRAGMENT_SHADER);
return OOGL.Ajax.get(a,function(e){if(c.source(e),c.compile(),!d.getShaderParameter(c,d.COMPILE_STATUS))throw"Failed to compile <"+a+">, info log follows.\n"+d.getShaderInfoLog(c);b&&b.call(c)}),c},d.Program=function(){function a(a){return c[a]=d.getUniformLocation(b,a)}var b=d.createProgram(),c={};return b.getParameter=function(a){return d.getProgramParameter(b,a)},b.attachShader=function(a){d.attachShader(b,a)},b.detachShader=function(a){d.detachShader(b,a)},b.getAttachedShaders=function(){return d.getAttachedShaders(b)},b.getNumberOfAttachedShaders=function(){return d.getProgramParameter(b,d.ATTACHED_SHADERS)},b.bindAttribLocation=function(a,c){d.bindAttribLocation(b,a,c)},b.bindAttribLocations=function(a){for(var c in a)a.hasOwnProperty(c)&&d.bindAttribLocation(b,parseInt(c,10),a[c])},b.link=function(){c={},d.linkProgram(b)},b.getLinkStatus=function(){return d.getProgramParameter(b,d.LINK_STATUS)},b.getInfoLog=function(){return d.getProgramInfoLog(b)},b.linkOrThrow=function(){if(c={},d.linkProgram(b),!d.getProgramParameter(b,d.LINK_STATUS))throw d.getProgramInfoLog(b)},b.use=function(){d.useProgram(b)},b.validate=function(){d.validateProgram(b)},b.getValidateStatus=function(){return d.getProgramParameter(b,d.VALIDATE_STATUS)},b.validateOrThrow=function(){if(d.validateProgram(b),!d.getProgramParameter(b,d.VALIDATE_STATUS))throw"program validation failed."},b.getActiveAttrib=function(a){return d.getActiveAttrib(b,a)},b.getNumberOfActiveAttributes=function(){return d.getProgramParameter(b,d.ACTIVE_ATTRIBUTES)},b.getActiveUniform=function(a){return d.getActiveUniform(b,a)},b.getNumberOfActiveUniforms=function(){return d.getProgramParameter(b,d.ACTIVE_UNIFORMS)},b.getAttribLocation=function(a){return d.getAttribLocation(b,a)},b.getUniform=function(a){return"string"!=typeof a?d.getUniform(b,a):d.getUniform(b,c[a]||(c[a]=d.getUniformLocation(b,a)))},b.getUniformLocation=a,b.uniform=function(b){for(var c in b)b.hasOwnProperty(c)&&d["uniform"+b[c].type](a(c),b[c].value)},b.uniform1f=function(b,c){d.uniform1f(a(b),c)},b.uniform2f=function(b,c,e){d.uniform2f(a(b),c,e)},b.uniform3f=function(b,c,e,f){d.uniform3f(a(b),c,e,f)},b.uniform4f=function(b,c,e,f,g){d.uniform4f(a(b),c,e,f,g)},b.uniform1fv=function(b,c){d.uniform1fv(a(b),c)},b.uniform2fv=function(b,c){d.uniform2fv(a(b),c)},b.uniform3fv=function(b,c){d.uniform3fv(a(b),c)},b.uniform4fv=function(b,c){d.uniform4fv(a(b),c)},b.uniform1i=function(b,c){d.uniform1i(a(b),c)},b.uniform2i=function(b,c,e){d.uniform2i(a(b),c,e)},b.uniform3i=function(b,c,e,f){d.uniform3i(a(b),c,e,f)},b.uniform4i=function(b,c,e,f,g){d.uniform4i(a(b),c,e,f,g)},b.uniform1iv=function(b,c){d.uniform1iv(a(b),c)},b.uniform2iv=function(b,c){d.uniform2iv(a(b),c)},b.uniform3iv=function(b,c){d.uniform3iv(a(b),c)},b.uniform4iv=function(b,c){d.uniform4iv(a(b),c)},b.uniformVec2=function(b,c){d.uniform2f(a(b),c.x,c.y)},b.uniformVec3=function(b,c){d.uniform3f(a(b),c.x,c.y,c.z)},b.uniformVec4=function(b,c){d.uniform2f(a(b),c.x,c.y,c.z,c.w)},b.uniformMatrix2fv=function(b,c){d.uniformMatrix2fv(a(b),!1,c)},b.uniformMatrix3fv=function(b,c){d.uniformMatrix3fv(a(b),!1,c)},b.uniformMatrix4fv=function(b,c){d.uniformMatrix4fv(a(b),!1,c)},b.uniformMat2=function(b,c){d.uniformMatrix2fv(a(b),!1,[c[0],c[1],c[2],c[3]])},b.uniformMat3=function(b,c){d.uniformMatrix3fv(a(b),!1,[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]])},b.uniformMat4=function(b,c){d.uniformMatrix4fv(a(b),!1,[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15]])},b._delete=function(){d.deleteProgram(b)},b.getDeleteStatus=function(){return d.getProgramParameter(b,d.DELETE_STATUS)},b},d.AutoProgram=function(a,b,c){var e=new d.Program,f=new d.VertexShader(a),g=new d.FragmentShader(b);return e.getVertexShader=function(){return f},e.getFragmentShader=function(){return g},e.enableVertexAttribArrays=function(){for(var a=0;a<c.length;a++)d.enableVertexAttribArray(a)},e.disableVertexAttribArrays=function(){for(var a=0;a<c.length;a++)d.disableVertexAttribArray(a)},e.attachShader(f),e.attachShader(g),e.bindAttribLocations(c),e.linkOrThrow(),e},d.AjaxProgram=function(a,b,c){var e,f,g=new d.Program;return OOGL.Async.parallel(function(b){e=new d.AjaxVertexShader(a+".vert",b)},function(b){f=new d.AjaxFragmentShader(a+".frag",b)})(function(){if(g.attachShader(e),g.attachShader(f),g.getVertexShader=function(){return e},g.getFragmentShader=function(){return f},g.enableVertexAttribArrays=function(){for(var a=0;a<b.length;a++)d.enableVertexAttribArray(a)},g.disableVertexAttribArrays=function(){for(var a=0;a<b.length;a++)d.disableVertexAttribArray(a)},g.bindAttribLocations(b),g.link(),!d.getProgramParameter(g,d.LINK_STATUS))throw"Failed to link <"+a+">, info log follows.\n"+d.getProgramInfoLog(g);c&&c.call(g)}),g},d.Framebuffer=function(){var a=d.createFramebuffer();return a.is=function(){return d.isFramebuffer(a)},a.getAttachmentParameter=function(a,b){return d.getFramebufferAttachmentParameter(d.FRAMEBUFFER,a,b)},a.bind=function(){d.bindFramebuffer(d.FRAMEBUFFER,a)},a.checkStatus=function(){return d.checkFramebufferStatus(d.FRAMEBUFFER)},a.renderbuffer=function(a,b){d.framebufferRenderbuffer(d.FRAMEBUFFER,a,d.RENDERBUFFER,b)},a.texture2D=function(a,b,c,e){d.framebufferTexture2D(d.FRAMEBUFFER,a,b,c,e)},a._delete=function(){d.deleteFramebuffer(a)},a},d.Renderbuffer=function(){var a=d.createRenderbuffer();return a.is=function(){return d.isRenderbuffer(a)},a.getParameter=function(a){return d.getRenderbufferParameter(d.RENDERBUFFER,a)},a.getWidth=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_WIDTH)},a.getHeight=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_HEIGHT)},a.getInternalFormat=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_INTERNAL_FORMAT)},a.getRedSize=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_RED_SIZE)},a.getGreenSize=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_GREEN_SIZE)},a.getBlueSize=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_BLUE_SIZE)},a.getAlphaSize=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_ALPHA_SIZE)},a.getDepthSize=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_DEPTH_SIZE)},a.getStencilSize=function(){return d.getRenderbufferParameter(d.RENDERBUFFER,d.RENDERBUFFER_STENCIL_SIZE)},a.bind=function(){d.bindRenderbuffer(d.RENDERBUFFER,a)},a.storage=function(a,b,c){d.renderbufferStorage(d.RENDERBUFFER,a,b,c)},a._delete=function(){d.deleteRenderbuffer(a)},a},d.Loader=function(){function a(a,b,c){this.getData=function(b){return a.hasOwnProperty(b)?a[b]:void 0},this.getTexture=function(a){return b.hasOwnProperty(a)?b[a]:void 0},this.getProgram=function(a){return c.hasOwnProperty(a)?c[a]:void 0},this.discard=function(){a={};var d;for(d in b)b.hasOwnProperty(d)&&b[d]._delete();b={};for(d in c)c.hasOwnProperty(d)&&c[d]._delete();c={}}}var b=this,c=[];this.queueData=function(a,d,e){return arguments.length>2?c.push(function(b,c,f,g,h){OOGL.Ajax.get(a,d,function(c){b[a]=c,g&&g.call(h)},e)}):c.push(function(b,c,d,f,g){OOGL.Ajax.get(a,function(c){b[a]=c,f&&f.call(g)},e)}),b},this.queueJSON=function(a,d){return arguments.length>1?c.push(function(b,c,e,f,g){OOGL.Ajax.getJSON(a,d,function(c){b[a]=c,f&&f.call(g)})}):c.push(function(b,c,d,e,f){OOGL.Ajax.getJSON(a,function(c){b[a]=c,e&&e.call(f)})}),b},this.queueTexture=function(a,e,f){return arguments.length<2?(e=d.LINEAR,f=d.LINEAR):arguments.length<3&&(f=d.LINEAR),c.push(function(b,c,g,h,i){c[a]=new d.AsyncTexture(a,function(){h&&h.call(i)},e,f)}),b},this.queueTextures=function(a,e,f){return arguments.length<2?(e=d.LINEAR,f=d.LINEAR):arguments.length<3&&(f=d.LINEAR),c.push.apply(c,a.map(function(a){return function(b,c,g,h,i){c[a]=new d.AsyncTexture(a,function(){h&&h.call(i)},e,f)}})),b},this.queueProgram=function(a,e){return c.push(function(b,c,f,g,h){f[a]=new d.AjaxProgram(a,e,function(){g&&g.call(h)})}),b},this.queuePrograms=function(a){for(var e in a)a.hasOwnProperty(e)&&c.push(function(a,b){return function(c,e,f,g,h){f[a]=new d.AjaxProgram(a,b,function(){g&&g.call(h)})}}(e,a[e]));return b},this.loadAssets=function(b,d){var e={},f={},g={},h=c.length,i=0,j=c.map(function(a){return function(b,c){a(e,f,g,function(){d&&d(100*++i/h),b&&b.call(c)})}});c=[],OOGL.Async.parallel(j)(function(){b(new a(e,f,g))})}},d},OOGL.RenderLoop=function(){var a="auto",b=60,c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,d=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,e=function(a,b){var e=Math.floor(1e3/b);return function(f){function g(){var a=null;this.start=function(){null===a&&(a=c(function b(){n++,f(),a=c(b)}))},this.stop=function(){null!==a&&(d(a),a=null)}}function h(){var a=null;this.start=function(){null===a&&(a=setInterval(function(){n++,f()},e))},this.stop=function(){null!==a&&(clearInterval(a),a=null)}}var i,j,k,l=!1,m=!1,n=0,o=0;switch(a){case"request":k=new g;break;case"interval":k=new h;break;default:c?(a="request",k=new g):(a="interval",k=new h)}this.getType=function(){return a},this.getRate=function(){return b},this.getPeriod=function(){return e},this.getActualRate=function(){var a;a=m?j:Date.now();var b=n/(a-i-o);return n=0,i=a,o=0,b},this.start=function(){l||m||(l=!0,i=Date.now(),k.start())},this.suspend=function(){l&&(m=!0,j=Date.now(),k.stop())},this.resume=function(){l&&(m=!1,o+=Date.now()-j,k.start())},this.stop=function(){l=!1,m=!0,j=Date.now(),k.stop()}}}(a,b);return e.isRequestAnimationFrameSupported=function(){return!!c},e.getType=function(){return a},e.setType=function(b){if(!{request:!0,interval:!0,auto:!0}.hasOwnProperty(a))throw"invalid loop type, must be one of `request`, `interval` or `auto`.";a=b},e.getRate=function(){return b},e.getPeriod=function(){return Math.floor(1e3/b)},e.setRate=function(a){b=a},e}();